<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Detaylı Analiz</title>
  <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      background: #1a1a1a;
    }
    #chart {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
  <div id="chart"></div>
  <script>
    // Coin-TradingView Sembol Eşleştirmesi
    const coinSymbols = {
      "BTC": "BINANCE:BTCUSDT",
      "ETH": "BINANCE:ETHUSDT",
      "ADA": "BINANCE:ADAUSDT",
      "AVAX": "BINANCE:AVAXUSDT",
      "MANA": "BINANCE:MANAUSDT",
      "BNB": "BINANCE:BNBUSDT",
      "XRP": "BINANCE:XRPUSDT",
      "SOL": "BINANCE:SOLUSDT",
      "DOGE": "BINANCE:DOGEUSDT",
      "TRX": "BINANCE:TRXUSDT"
    };

    // İndikatör Çalışma Adları
    const studyMapping = {
      RSI: "RSI@tv-basicstudies",
      EMA: "MAExp@tv-basicstudies",
      MACD: "MACD@tv-basicstudies",
      BBANDS: "BB@tv-basicstudies",
      ATR: "ATR@tv-basicstudies",
      STOCH: "Stochastic@tv-basicstudies",
      DX: "STD;DMI",
      ICHIMOKU: "IchimokuCloud@tv-basicstudies",
      OBV: "OBV@tv-basicstudies",
      KELTNER: "KLTNR@tv-basicstudies",
      SAR: "PSAR@tv-basicstudies",
      VWAP: "VWAP@tv-basicstudies",
      MFI: "MF@tv-basicstudies", 
      SUPERTREND: "STD;Supertrend",
      CCI: "CCI@tv-basicstudies"
    };

    // URL Parametrelerini Oku
    const urlParams = new URLSearchParams(window.location.search);
    const indicator = urlParams.get('indicator') || 'RSI';
    const coin = urlParams.get('coin') || 'ETH';

    // TradingView Sembolünü Belirle
    const symbol = coinSymbols[coin.toUpperCase()] || coinSymbols.ETH;

    // TradingView Widget'ını Başlat
    new TradingView.widget({
      width: "100%",
      height: "100%",
      symbol: symbol,
      interval: "15",
      theme: "dark",
      studies: [studyMapping[indicator.toUpperCase()] || studyMapping.RSI], // 1. Düzeltme: Fazla köşeli parantez kaldırıldı
      enabled_features: ["use_localstorage_for_settings", "show_study_labels"],
      disabled_features: ["volume_force_overlay"],
      overrides: {
        "volume.volume.color.0": "#00000000",
        "volume.volume.color.1": "#00000000"
      },
      container_id: "chart",
      locale: "tr"
    }); // 2. Düzeltme: Eksik parantez kapatma eklendi
  </script>
</body>
</html>