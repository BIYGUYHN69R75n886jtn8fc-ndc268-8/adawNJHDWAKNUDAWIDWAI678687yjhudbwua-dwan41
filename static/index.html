<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>GRYPTO</title>
    <link rel="stylesheet" href="css.css">
</head>
<body>

    <div class="tradingview-widget-container" style="border-bottom: 1px solid #334155;">
    <div class="tradingview-widget-container__widget"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
    {
    "symbols": [
      {
        "proName": "BINANCE:BTCUSDT",
        "title": "Bitcoin"
      },
      {
        "proName": "BINANCE:ETHUSDT",
        "title": "Ethereum"
      },
      {
        "proName": "BINANCE:BNBUSDT",
        "title": "BNB"
      },
      {
        "proName": "BINANCE:XRPUSDT",
        "title": "XRP"
      },
      {
        "description": "DXY (Dolar Endeksi)",
        "proName": "TVC:DXY"
      },
      {
        "description": "AltÄ±n (Ons)",
        "proName": "OANDA:XAUUSD"
      },
      {
        "description": "S&P 500 (ABD BorsasÄ±)",
        "proName": "FOREXCOM:SPXUSD"
      }
    ],
    "showSymbolLogo": true,
    "colorTheme": "dark",
    "isTransparent": true,
    "displayMode": "adaptive",
    "locale": "tr"
  }
    </script>
  </div>

    <div id="chat-widget" class="collapsed">
        <div id="chat-header">
          ðŸ§  Grypto AI 
          <button id="toggle-expand" title="GeniÅŸlet" style="float: right;">&#x2922;</button>
        </div>
        <div id="chat-messages"></div>
        <div id="chat-input">
          <textarea id="user-input" placeholder="Ä°ndikatÃ¶r verilerini gir veya soru sor..." rows="2"></textarea>
          <button onclick="sendMessage()">Analiz</button>
        </div>
      </div>
      
      <!-- Chat Widget iÃ§in JavaScript -->
      <script>
        // Toggle chat widget bÃ¼yÃ¼tme/kÃ¼Ã§Ã¼ltme
        document.getElementById('toggle-expand').addEventListener('click', function() {
          var widget = document.getElementById('chat-widget');
          widget.classList.toggle('expanded');
          widget.classList.toggle('collapsed');
          // Buton simgesini gÃ¼ncelle (Ã¶rneÄŸin: geniÅŸletme iÃ§in "â‡±", kÃ¼Ã§Ã¼ltme iÃ§in "â‡²")
          if(widget.classList.contains('expanded')) {
            this.innerHTML = "&#x2923;"; // KÃ¼Ã§Ã¼ltme simgesi
          } else {
            this.innerHTML = "&#x2922;"; // GeniÅŸletme simgesi
          }
        });
      
        async function sendMessage() {
          const textareaEl = document.getElementById('user-input');
          const message = textareaEl.value.trim();
          if (!message) return;
          textareaEl.value = "";
          
          const chatMessages = document.getElementById('chat-messages');
          const userMsgDiv = document.createElement('div');
          userMsgDiv.className = 'message';
          userMsgDiv.innerHTML = `<strong>Siz:</strong> ${message}`;
          chatMessages.appendChild(userMsgDiv);
          chatMessages.scrollTop = chatMessages.scrollHeight;
          
          try {
            const response = await fetch('/chat', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ input: message })
            });
            const data = await response.json();
            const botMsgDiv = document.createElement('div');
            botMsgDiv.className = 'message';
            if (data.response) {
              botMsgDiv.innerHTML = `<strong>Asistan:</strong> ${data.response}`;
            } else {
              botMsgDiv.innerHTML = `<strong>Hata:</strong> ${data.error}`;
            }
            chatMessages.appendChild(botMsgDiv);
          } catch (error) {
            const errorMsgDiv = document.createElement('div');
            errorMsgDiv.className = 'message';
            errorMsgDiv.innerHTML = `<strong>Hata:</strong> ${error.message}`;
            chatMessages.appendChild(errorMsgDiv);
          }
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }
      
        // EÄŸer isterseniz, textarea iÃ§erisinde Shift+Enter ile yeni satÄ±r eklenirken,
        // sadece Enter tuÅŸuna basÄ±ldÄ±ÄŸÄ±nda mesaj gÃ¶ndermeyi engellemek iÃ§in aÅŸaÄŸÄ±daki kodu ekleyebilirsiniz.
        document.getElementById('user-input').addEventListener('keydown', function(e) {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault(); // Enter tuÅŸunun yeni satÄ±r eklemesini engelle
            sendMessage();
          }
        });
      </script>
    

    <div class="sidebar">
      <h1 onclick="location.href='index.html'">
        <img src="logo.png" alt="GRYPTO Logo" class="logo">
      </h1>
        <div class="coin-list">
          <div class="coin-item" onclick="location.href='bitcoin.html'">Bitcoin</div>
          <div class="coin-item" onclick="location.href='ethereum.html'">Ethereum</div>
          <div class="coin-item" onclick="location.href='ada.html'">ADA</div>
          <div class="coin-item" onclick="location.href='avax.html'">AVAX</div>
          <div class="coin-item" onclick="location.href='mana.html'">MANA</div>
          <div class="coin-item" onclick="location.href='bnb.html'">BNB</div>
          <div class="coin-item" onclick="location.href='xrp.html'">XRP</div>
          <div class="coin-item" onclick="location.href='solana.html'">SOLANA</div>
          <div class="coin-item" onclick="location.href='doge.html'">DOGE</div>
          <div class="coin-item" onclick="location.href='trx.html'">TRX</div>
        </div>
      </div>

  <div class="main-content">
    
    <div style="width: 100%; border-bottom: 1px solid #334155; margin-bottom: 25px; margin-top: -15px;">
      <div class="tradingview-widget-container">
        <div class="tradingview-widget-container__widget"></div>
        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
        {
        "symbols": [
          {
            "proName": "BINANCE:BTCUSDT",
            "title": "Bitcoin"
          },
          {
            "proName": "BINANCE:ETHUSDT",
            "title": "Ethereum"
          },
          {
            "proName": "BINANCE:BNBUSDT",
            "title": "BNB"
          },
          {
            "proName": "BINANCE:XRPUSDT",
            "title": "XRP"
          },
          {
            "description": "DXY (Dolar Endeksi)",
            "proName": "TVC:DXY"
          },
          {
            "description": "AltÄ±n (Ons)",
            "proName": "OANDA:XAUUSD"
          },
          {
            "description": "S&P 500 (ABD BorsasÄ±)",
            "proName": "FOREXCOM:SPXUSD"
          }
        ],
        "showSymbolLogo": true,
        "colorTheme": "dark",
        "isTransparent": true,
        "displayMode": "adaptive",
        "locale": "tr"
      }
        </script>
      </div>
    </div>
  
        <div class="news-container">
            <div class="news-column" id="bitcoin-news">
                <h3>BITCOIN HABERLERÄ°</h3>
                
                <div class="news-items"></div>
            </div>
            <div class="news-column" id="ethereum-news">
                <h3> ETHEREUM HABERLERÄ°</h3>
            
                <div class="news-items"></div>
            </div>
        </div>
    </div>

    <script>
    const API_KEY = 'jjislkhw1wz9tldkkahbmyodidc2bgab5eezvrzn';

async function fetchNews(tag, containerId) {
    try {
        const apiUrl = `https://api.rss2json.com/v1/api.json?api_key=${API_KEY}&rss_url=https://cointelegraph.com/rss/tag/${tag}`;
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error(`HTTP hatasÄ±: ${response.status}`);
        
        const data = await response.json();
        if (data.status !== 'ok') throw new Error(data.message);
        
        const container = document.querySelector(`#${containerId} .news-items`);
        container.innerHTML = data.items.slice(0,5).map(item => `
            <div class="news-item">
                <img src="${item.enclosure?.link || 'https://i.ibb.co/0j7JQYV/placeholder-news.png'}" 
                     class="news-image"
                     onerror="this.src='https://i.ibb.co/0j7JQYV/placeholder-news.png'">
                <div class="news-content">
                    <span class="news-date">${new Date(item.pubDate).toLocaleString('tr-TR')}</span>
                    <h4><a href="${item.link}" target="_blank">${item.title}</a></h4>
                    <p class="news-excerpt">${item.description.replace(/<[^>]+>/g, '').substring(0,100)}...</p>
                </div>
            </div>
        `).join('');
    } catch (error) {
        document.querySelector(`#${containerId} .news-items`).innerHTML = 
            `<div class="error">${error.message}</div>`;
    }
}

window.onload = () => {
    Notification.requestPermission();
    fetchNews('bitcoin', 'bitcoin-news');
    fetchNews('ethereum', 'ethereum-news');
    setInterval(() => {
        fetchNews('bitcoin', 'bitcoin-news');
        fetchNews('ethereum', 'ethereum-news');
    }, 300000); // 5 dakikada bir gÃ¼ncelle
};
    </script>
</body>

</html>

